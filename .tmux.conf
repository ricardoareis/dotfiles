# Basic properties {
# vim: set expandtab sw=4 ts=4 sts=4 et tw=78 ft=tmux foldmarker={,} foldlevel=0 foldmethod=marker spell:
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g default-shell $SHELL
set -s escape-time 0

set -g history-limit 100000 # increase scrollback buffer size
set -g display-time    4000 # tmux messages are displayed for 4 seconds

# Disable all kinds of activities
setw -g monitor-activity off
set  -g visual-activity  off

# Start windows and panes at 1, not 0
set  -g base-index 1
setw -g pane-base-index 1

# focus events enabled for terminals that support them
set -g focus-events on

setw -g xterm-keys on

# enable mouse support for switching panes/windows
set -g mouse on
#}

# Binds properties {
bind r source-file ~/.tmux.conf \; display ".tmux.conf reloaded!" # reload config file
bind C-s setw synchronize-panes                                   # synchronize all panes in a window

# copy mode using 'Esc'
set  -g status-keys vi
setw -g mode-keys   vi

# changed prefix to Home (capslock is mapped to home in a system)
set -g prefix Home
bind-key Home send-prefix
unbind C-b

# better split keys
bind-key v split-window -h -c "#{pane_current_path}"
bind-key h split-window -v -c "#{pane_current_path}"

# Configure copying
unbind Escape           # when inside of copy-mode (prefix+[),
                        # use Escape to cancel 'v' selection  

bind [ copy-mode        # toggle copy-mode w/ same keyword
bind-key p paste-buffer # paste the selection as a vim editor

bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'r' send-keys -X rectangle-toggle

# Windows properties
if-shell -b '[[ ! -z "$(command -v explorer.exe)" ]]' " \
    bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel '/mnt/c/Windows/System32/clip.exe'; \
    bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel '/mnt/c/Windows/System32/clip.exe'; \
    bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel '/mnt/c/Windows/System32/clip.exe'"

if-shell -b '[[ -z "$(command -v explorer.exe)" ]]' TMUX_FZF_SED="gsed"

# Pipe the current pane to a log file with Shift-L - Press Shift-L again to stop.
bind-key L pipe-pane -o "cat >>$HOME/#W-tmux.log" \; display-message "Toggled logging to $HOME/#W-tmux.log"

#}

# Status bar properties {
set -g status-interval 5
set -g status-left-length 20
set -g @prefix_highlight_fg colour226 #'white' # default is 'colour231'
set -g @prefix_highlight_bg colour236 #colour04  #'blue'  # default is 'colour04'
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_copy_mode_attr 'fg=colour236, bg=colour226, bold' # default is 'fg=default,bg=yellow'
set -g @prefix_highlight_prefix_prompt 'Wait'
set -g @prefix_highlight_copy_prompt 'Copy'
set -g @prefix_highlight_output_prefix '< '
set -g @prefix_highlight_output_suffix ' >'
set -g status-right '#{prefix_highlight} #($PYENV_ROOT/shims/powerline tmux right)'
run-shell "$PYENV_ROOT/shims/powerline-daemon -q --replace"
set -g status-position bottom
set -g status-bg colour236 #colour237
set -g status-fg colour236 #colour137
set -g status-right-length 150
set -g @colors-solarized '256'

# Window configuration over status bar
set-window-option -g window-status-current-format \
'#[bg=black]#[fg=white,bold](#{window_index}) #[fg=white]#{pane_current_command} \
#[fg=write]#(~/repos/dotfiles/bin/getTruncatedFolder.zsh #{pane_current_path}) #[fg=white,bold]|'

set-window-option -g window-status-format \
'#[fg=white,bold](#{window_index}) #[fg=green]#{pane_current_command} \
#[fg=blue]#(~/repos/dotfiles/bin/getTruncatedFolder.zsh #{pane_current_path}) #[fg=white]|'
#}

# Plugins: Included here to be installed {
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'seebi/tmux-colors-solarized'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'jbnicolai/tmux-fpp'
#}

# Plugins: FZF properties {
set -g @tmux-fzf-launch-key 'T'
#}

# Plugins: Fingers properties {
set -g @fingers-compact-hints 0
set -g @fingers-key C-f
#}

# Plugins: Included here to be executed {
run -b '~/.tmux/plugins/tpm/tpm'
run-shell ~/.tmux/plugins/tmux-fpp/fpp.tmux
run-shell ~/.tmux/plugins/tmux-fingers/tmux-fingers.tmux
run-shell ~/.tmux/plugins/tmux-resurrect/resurrect.tmux
run-shell ~/.tmux/plugins/tmux-continuum/continuum.tmux
#}
